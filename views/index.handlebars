<div id="accordion">
  {{#each articles}}
  <div class="card">
    <div class="card-header" id="heading{{@index}}: {{this}}">
      <h5 class="mb-0">
        <button class="btn btn-link" data-index={{@index}} data-toggle="collapse" data-target="#collapse{{@index}}" aria-expanded="true" aria-controls="collapse{{@index}}: {{this}}">
          {{title}}
        </button>
      </h5>
    </div>

    <div id="collapse{{@index}}" class="collapse" aria-labelledby="heading{{@index}}" data-parent="#accordion">
      <div class="card-body">
        {{#each content}}
          <p>{{this}}</p>
        {{/each}}
        <a href={{link}} target="_blank"><button class="btn btn-info">View On Site</button></a>
        <button class="btn btn-info comment-button" data-index="{{@index}}">Comments</button>
      </div>
    </div>

    <div id="comments{{@index}}" class="comments-section"  data-active="false">
      <h2 class="text-center">Comments</h2>
      <ul class="list-group m-3">
        <li class="list-group-item">
        <form class="form" action="/comment" method="POST">
          <input type="hidden" name="article" value="{{_id}}">
          <textarea name="comment" id="commentArea"></textarea>
          <button class="btn btn-success align-self-right" type="submit">Submit</button>
        </form>
        </li>
        {{#each comments}}
          <li class="list-group-item">
            <div class="row">
              <div class="col-10">
              {{this.body}}
              </div>
              <div class="col-2">
                <form action="/comment?_method=DELETE" method="POST">
                  <input type="hidden" name="_method" value="DELETE">
                  <input type="hidden" name="comment" value={{this._id}}>
                  <button type="submit" class="btn btn-danger">Delete</button>
                </form>
              </div>
            </div>
          </li>
        {{else}}
        <li class="list-group-item">
          <p>No Comments</p>
        </li>
        {{/each}}
      </ul>
    </div>
  </div>
  {{/each}}
</div>

<style>
#commentArea {
  width: 100%;
}
.comments-section {
  display: none;
}
</style>

<script>
  $('.btn-link').on('click', event => {
     $(`#comments${$(event.target).data('index')}`).hide(); 
  });
  $('.comment-button').on('click', event => {
    $(`#comments${$(event.target).data('index')}`).slideToggle("fast");
  });
</script>